'''
Created on May 12, 2013

@author: Arjun
'''

import socket
import string
import urllib

HOST = "irc.snoonet.org"
PORT = 6667
NICK = "Twaltbot"
IDENT = "Twaltbot"
REALNAME = "Twaltbot"
readbuffer = ""

sock = socket.socket();
sock.connect((HOST, PORT))
sock.send("NICK %s\r\n" % NICK)
sock.send("USER %s %s bla :%s\r\n" % (IDENT, HOST, REALNAME))
sock.send("JOIN #korean, \r\n")


while 1:
    readbuffer=readbuffer+sock.recv(1024)
    temp=string.split(readbuffer, "\n")
    readbuffer=temp.pop( )


    for line in temp:
        line=string.rstrip(line)
        line=string.split(line)
        print line
        if line[0] == "PING":
            sock.send("PONG %s\r\n" % line[1])
        if(line[1]=='PRIVMSG' and line[3] == ':.lookup'):
            if len(line) > 4:
                html = urllib.urlopen("http://dic.naver.com/search.nhn?query=%s" % ' ' .join(line[4:])).read()
                soup = bs4.BeautifulSoup(html)
                try:
                    sock.send("PRIVMSG %s :%s\r\n" %(line[2], unicode(soup.find_all("dd")[1].get_text()).encode('utf8').strip()))

                except IndexError:
                    sock.send("PRIVMSG %s :Page not found\r\n" % (line[2]))

            else:
                sock.send("PRIVMSG %s :.lookup <word>\r\n" % (line[2]))









